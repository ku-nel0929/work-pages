<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="google-site-verification" content="YdkYdalhqx1MHFQb7aFVKFsD7n2bUpgKDN--q0rWI9E" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LegalService",
      "name": "植村 土地家屋調査士・行政書士事務所",
      "image": "https://ku-nel0929.github.io/work-pages/sokkia-bg.png",
      "url": "https://ku-nel0929.github.io/work-pages/",
      "telephone": "080-7231-9467",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "花城町12番6号",
        "addressLocality": "花巻市",
        "addressRegion": "岩手県",
        "postalCode": "025-0075",
        "addressCountry": "JP"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": 39.3905,
        "longitude": 141.1186
      },
      "priceRange": "相談無料",
      "description": "岩手県花巻市の農地転用許可申請、土地の測量・分筆登記なら植村事務所へ。SIMAデータ読込による位置特定や登録免許税計算ツールも無料公開中。"
    }
    </script>

    <title>位置図作成・SIMA読込・農地転用 | 植村 土地家屋調査士・行政書士事務所</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #0f2350;
            --survey-color: #c5a059;
            --admin-color: #3b6c9b;
            --text-color: #333;
            --bg-body: #f0f0f0;
        }
        
        body { font-family: "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; color: var(--text-color); background-color: var(--bg-body); line-height: 1.6; }
        a { text-decoration: none; color: inherit; }
        img { max-width: 100%; height: auto; }
        
        header { background-color: var(--primary-color); color: #fff; padding: 15px 0; text-align: center; }
        .logo { font-size: 1.4rem; font-weight: bold; }

        .hero {
            background-color: #87CEEB;
            background-image: url('sokkia-bg.png');
            background-size: cover; background-position: center;
            height: 400px; display: flex; align-items: center; justify-content: center;
            text-align: center; color: #fff; text-shadow: 0 2px 8px rgba(0,0,0,0.7);
            position: relative;
        }
        .hero::before { content: ''; position: absolute; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.3); }
        .hero-content { position: relative; z-index: 2; }
        .hero-content h1 { font-size: 2rem; margin: 0 20px; font-weight: bold; }

        .main-wrapper { max-width: 1000px; margin: 0 auto; background-color: #fff; padding: 40px 0; }

        /* ボタン群 */
        .main-actions { padding: 0 20px; margin-bottom: 40px; }
        .action-grid { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .action-box { flex: 1; min-width: 280px; padding: 30px 20px; border-radius: 8px; text-align: center; color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.15); transition: transform 0.2s; }
        .action-box:hover { transform: translateY(-3px); }
        .box-survey { background-color: var(--survey-color); }
        .box-admin { background-color: var(--admin-color); }
        .box-title { font-size: 1.4rem; font-weight: bold; display: block; margin-bottom: 10px; }
        .phone-area { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 30px; display: inline-flex; align-items: center; gap: 10px; font-weight: bold; font-size: 1.2rem; }

        /* フォーム */
        .contact-section { padding: 40px 20px; }
        .section-title { text-align: center; color: var(--primary-color); border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 30px; }
        .contact-form { max-width: 800px; margin: 0 auto; background: #f9fbfd; padding: 30px; border-radius: 8px; border: 1px solid #ddd; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: bold; margin-bottom: 5px; color: var(--primary-color); }
        .form-input, .form-textarea, .form-select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .form-textarea { height: 120px; }
        .submit-btn { background-color: var(--primary-color); color: #fff; border: none; padding: 15px 40px; font-size: 1.1rem; font-weight: bold; border-radius: 5px; cursor: pointer; display: block; margin: 30px auto 0; width: 100%; max-width: 300px; }
        
        /* ツール共通 */
        .tool-section { padding: 40px 20px; max-width: 800px; margin: 0 auto 40px; background: #f5f8fc; border-radius: 8px; border: 1px solid #dce4ec; }
        .tool-box { background: #fff; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .tool-header { text-align: center; margin-bottom: 15px; font-weight: bold; color: var(--primary-color); border-bottom: 1px dashed #ccc; padding-bottom: 10px; }
        .tool-input-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .tool-btn { padding: 10px 20px; border-radius: 4px; cursor: pointer; border: none; color: #fff; white-space: nowrap; }
        .active-btn { background-color: #0f2350; }
        .inactive-btn { background-color: #999; opacity: 0.8; }

        /* 位置図マップエリア（重要：高さ固定） */
        #mapContainer {
            width: 100%;
            height: 500px; /* 高さを明示 */
            background: #eee;
            margin-top: 15px;
            border: 1px solid #ccc;
            position: relative;
        }
        /* Google MapとLeafletの切り替え用 */
        #googleMapFrame { width: 100%; height: 100%; border: 0; display: block; }
        #simaLeafletMap { width: 100%; height: 100%; display: none; } /* 初期は非表示 */

        /* ファイルドロップ */
        .file-upload-area { border: 3px dashed #ccc; padding: 30px; text-align: center; border-radius: 8px; background: #fafafa; margin-bottom: 15px; cursor: pointer; transition: 0.3s; }
        .file-upload-area:hover { background: #eef4fb; border-color: var(--admin-color); }

        /* 相続図など */
        .family-input-row { display: flex; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 10px; flex-wrap: wrap; align-items: center; }
        .family-input-row input, .family-input-row select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .btn-add { background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
        .btn-del { background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
        #canvasContainer { text-align: center; overflow-x: auto; margin-top: 20px; display: none; }

        /* 印刷設定 */
        #printHeader { display: none; }
        @media print {
            @page { size: A4 portrait; margin: 5mm; }
            body { background: #fff; height: 100vh; overflow: hidden; }
            body > * { display: none !important; } /* 全て隠す */
            .main-wrapper { display: block !important; width: 100% !important; margin: 0 !important; padding: 0 !important; }
            /* 印刷対象のツールボックスのみ表示 */
            .tool-section, .tool-box { display: block !important; border: none !important; box-shadow: none !important; margin: 0 !important; padding: 0 !important; }
            
            /* マップ以外の要素を隠す */
            header, footer, .hero, .main-actions, .contact-section, .column-section, .office-info,
            .tool-section > h2, .tool-section > p, 
            .tool-box > *:not(#mapContainer):not(#printHeader),
            #tabChiban, #tabSima, .file-upload-area, #simaStatus {
                display: none !important;
            }

            /* 印刷ヘッダー表示 */
            #printHeader { display: block !important; border-bottom: 2px solid #000; margin-bottom: 10px; }
            #printHeader h1 { font-size: 24pt; margin: 0; }
            #printHeader p { font-size: 14pt; margin: 5px 0; }

            /* マップを最大化 */
            #mapContainer { height: 260mm !important; border: 2px solid #000 !important; }
            
            /* プロット(点)を隠す */
            .sima-marker { display: none !important; }
        }

        @media (max-width: 600px) {
            .family-input-row input { width: 100%; margin-top: 5px; }
        }
        .office-info { text-align: center; margin-top: 50px; padding: 20px; background: #f9f9f9; }
        .map-frame { width: 100%; height: 300px; background: #eee; margin-top: 20px; }
        footer { background: var(--primary-color); color: #aaa; text-align: center; padding: 20px 0; font-size: 0.8rem; }
    </style>
</head>
<body>

<header>
    <div class="logo">植村 土地家屋調査士・行政書士事務所</div>
</header>

<section class="hero">
    <div class="hero-content">
        <h1>家づくり・土地活用。<br>「測量」と「許認可」をワンストップで。</h1>
    </div>
</section>

<div class="main-wrapper">
    <div class="main-actions">
        <div class="action-grid">
            <div class="action-box box-survey">
                <a href="business-guide.png" target="_blank"><span class="box-title" style="text-decoration:underline; color:#fff;">土地家屋調査士業務</span></a>
                <div class="phone-area"><i class="fa-solid fa-mobile-screen"></i> 080-7231-9467</div>
            </div>
            <div class="action-box box-admin">
                <a href="admin-guide.png" target="_blank"><span class="box-title" style="text-decoration:underline; color:#fff;">行政書士業務</span></a>
                <div class="phone-area"><i class="fa-solid fa-mobile-screen"></i> 070-6625-6247</div>
            </div>
        </div>
    </div>

    <div class="contact-section">
        <h2 class="section-title">お問い合わせ</h2>
        <form action="https://formspree.io/f/mdkqdjlz" method="POST" class="contact-form">
            <div class="form-group"><label class="form-label">お名前 <span class="required">必須</span></label><input type="text" name="お名前" class="form-input" required></div>
            <div class="form-group"><label class="form-label">メールアドレス <span class="required">必須</span></label><input type="email" name="email" class="form-input" required></div>
            <div class="form-group"><label class="form-label">ご相談内容 <span class="required">必須</span></label><textarea name="詳細" class="form-textarea" required></textarea></div>
            <button type="submit" class="submit-btn">送信する</button>
        </form>
    </div>

    <div class="tool-section">
        <h2 class="section-title">【便利ツール】現場位置図検索</h2>
        <p style="text-align:center; font-size:0.9rem; margin-bottom:20px;">
            地番検索(Google)、またはSIMAファイル読込(地理院地図)で位置図を表示します。
        </p>
        
        <div class="tool-box">
            <div style="display:flex; justify-content:center; gap:10px; margin-bottom:15px;">
                <button type="button" class="tool-btn active-btn" id="tabChiban" onclick="setMode('chiban')">地番から検索</button>
                <button type="button" class="tool-btn inactive-btn" id="tabSima" onclick="setMode('sima')">SIMAから特定</button>
            </div>

            <div id="ctrlChiban">
                <div class="tool-input-group">
                    <input type="text" id="mapCity" class="form-input" placeholder="市町村 (例: 花巻市)" value="花巻市" style="flex:1;">
                    <input type="text" id="mapTown" class="form-input" placeholder="町名・大字" style="flex:1;">
                    <input type="text" id="mapLot" class="form-input" placeholder="地番" style="flex:1;">
                </div>
                <div style="text-align:center;"><button class="tool-btn active-btn" id="searchMapBtn">地図を表示</button></div>
            </div>

            <div id="ctrlSima" style="display:none;">
                <div class="file-upload-area" id="dropArea" onclick="document.getElementById('simaFile').click()">
                    <i class="fa-solid fa-file-arrow-up" style="font-size:2rem; color:#aaa;"></i><br>
                    <span style="font-weight:bold; color:#0f2350;">SIMAファイルをここにドロップ</span><br>
                    <span style="font-size:0.8rem; color:#666;">またはクリックして選択</span>
                    <input type="file" id="simaFile" accept=".sim,.sima,.txt" style="display:none;">
                </div>
                <div id="simaStatus" style="text-align:center; font-size:0.9rem; margin-bottom:10px; color:#0f2350; font-weight:bold;"></div>
            </div>

            <div id="printHeader">
                <h1>位置図</h1>
                <p>所在：<span id="printLocation"></span></p>
            </div>

            <div id="mapContainer">
                <iframe id="googleMapFrame" src="https://maps.google.co.jp/maps?q=花巻市&output=embed&t=m&z=13" frameborder="0" allowfullscreen></iframe>
                <div id="simaLeafletMap"></div>
            </div>

            <div style="text-align:center; margin-top:15px;">
                <button class="tool-btn" style="background-color:#c5a059;" onclick="printMap()">
                    <i class="fa-solid fa-print"></i> 位置図作成 (PDF保存・印刷)
                </button>
            </div>
        </div>
    </div>

    <div class="tool-section">
        <h2 class="section-title">【便利ツール】坪 ⇔ 平米 ⇔ 畳</h2>
        <div class="tool-box">
            <div class="family-input-row"><span class="tool-label">坪数</span><input type="number" id="tsubo" class="form-input"></div>
            <div class="family-input-row"><span class="tool-label">平米</span><input type="number" id="heibei" class="form-input"></div>
            <div class="family-input-row"><span class="tool-label">畳数</span><input type="number" id="jou" class="form-input"></div>
        </div>
    </div>

    <div class="tool-section">
        <h2 class="section-title">【便利ツール】登録免許税 (概算)</h2>
        <div class="tool-box">
            <div class="family-input-row"><span class="tool-label">評価額</span><input type="number" id="taxVal" class="form-input" placeholder="円"></div>
            <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
                <button class="tool-btn active-btn" onclick="calcTax(0.004)">保存(0.4%)</button>
                <button class="tool-btn active-btn" onclick="calcTax(0.02)">移転(2.0%)</button>
                <button class="tool-btn active-btn" onclick="calcTax(0.004)">抵当(0.4%)</button>
            </div>
            <div id="taxRes" style="text-align:center; margin-top:15px; font-size:1.2rem; font-weight:bold; color:#c5a059;">---</div>
        </div>
    </div>

    <div class="tool-section">
        <h2 class="section-title">【無料ツール】相続関係説明図</h2>
        <div class="tool-box">
            <div class="tool-header">被相続人</div>
            <div class="family-input-row"><input type="text" id="decName" placeholder="氏名" style="flex:1;"><input type="text" id="decDate" placeholder="死亡日" style="flex:1;"></div>
            <div class="tool-header">相続人</div>
            <div id="heirRows">
                <div class="family-input-row"><select disabled><option>配偶者</option></select><input type="text" id="spName" placeholder="氏名" style="flex:1;"></div>
            </div>
            <div style="text-align:right;"><button class="btn-add" onclick="addHeir()">＋子を追加</button></div>
            <div style="text-align:center; margin-top:10px;"><button class="tool-btn active-btn" onclick="drawFam()">図を作成</button></div>
        </div>
        <div id="canvasContainer"><canvas id="famCanvas" width="800" height="600"></canvas></div>
    </div>

    <div class="tool-section">
        <h2 class="section-title">郵便番号 ↔ 住所</h2>
        <div class="tool-box">
            <div class="tool-input-group"><input type="text" id="zipIn" class="form-input" placeholder="0250075"><button class="tool-btn active-btn" onclick="searchZip()">住所検索</button></div>
            <div id="zipOut" style="padding:5px;"></div>
            <div class="tool-input-group" style="margin-top:10px;"><input type="text" id="addrIn" class="form-input" placeholder="住所"><button class="tool-btn" style="background:#4285F4; color:#fff;" onclick="searchAddr()">Google検索</button></div>
        </div>
    </div>

    <script>
        // --- 1. マップ機能 ---
        let map = null; // Leafletインスタンス
        let simaLayer = null;
        let currentMode = 'chiban';
        let printLabel = "";

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('tabChiban').className = mode==='chiban' ? 'tool-btn active-btn' : 'tool-btn inactive-btn';
            document.getElementById('tabSima').className = mode==='sima' ? 'tool-btn active-btn' : 'tool-btn inactive-btn';
            
            const gMap = document.getElementById('googleMapFrame');
            const lMap = document.getElementById('simaLeafletMap');
            const ctrl1 = document.getElementById('ctrlChiban');
            const ctrl2 = document.getElementById('ctrlSima');

            if(mode === 'chiban') {
                gMap.style.display = 'block';
                lMap.style.display = 'none';
                ctrl1.style.display = 'block';
                ctrl2.style.display = 'none';
            } else {
                gMap.style.display = 'none';
                lMap.style.display = 'block';
                ctrl1.style.display = 'none';
                ctrl2.style.display = 'block';
                
                // Leaflet初期化 & サイズ更新 (重要)
                if(!map) initLeaflet();
                setTimeout(() => { map.invalidateSize(); }, 200);
            }
        }

        // GoogleMap検索
        document.getElementById('searchMapBtn').addEventListener('click', function() {
            const city = document.getElementById('mapCity').value;
            const town = document.getElementById('mapTown').value;
            const lot = document.getElementById('mapLot').value;
            if(!city || !town) { alert("市町村と町名を入力してください"); return; }
            
            const q = `${city} ${town} ${lot}`;
            printLabel = q;
            document.getElementById('googleMapFrame').src = `https://maps.google.co.jp/maps?q=${encodeURIComponent(q)}&output=embed&t=m&z=17`;
        });

        // Leaflet初期化
        function initLeaflet() {
            // 平面直角座標系10系 (岩手)
            if(typeof proj4 !== 'undefined') {
                proj4.defs("EPSG:6678", "+proj=tmerc +lat_0=40 +lon_0=140.8333333333333 +k=0.9999 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs");
            }
            
            const gsiStd = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {attribution: '地理院タイル'});
            const gsiOrt = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg', {attribution: '地理院タイル'});
            
            map = L.map('simaLeafletMap', {
                center: [39.3905, 141.1186],
                zoom: 15,
                layers: [gsiStd]
            });
            
            L.control.layers({"標準地図": gsiStd, "航空写真": gsiOrt}).addTo(map);
            simaLayer = L.layerGroup().addTo(map);
        }

        // SIMA読込
        const simaInput = document.getElementById('simaFile');
        const dropArea = document.getElementById('dropArea');
        const status = document.getElementById('simaStatus');

        function handleFile(file) {
            setMode('sima'); // 強制的にSIMA画面へ
            status.textContent = "読み込み中...";
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split(/\r\n|\n/);
                const points = [];
                let minX = 9e9, maxX = -9e9, minY = 9e9, maxY = -9e9;

                // 座標抽出ロジック
                lines.forEach(line => {
                    const parts = line.trim().split(/[\s,]+/);
                    for(let i=0; i<parts.length-1; i++) {
                        const v1 = parseFloat(parts[i]);
                        const v2 = parseFloat(parts[i+1]);
                        // 日本の座標系範囲チェック (X,Yどちらも1000~1000000の範囲)
                        if(!isNaN(v1) && !isNaN(v2) && Math.abs(v1)>1000 && Math.abs(v2)>1000) {
                            // 座標とみなす (X=v1, Y=v2)
                            if(v1 < minX) minX = v1; if(v1 > maxX) maxX = v1;
                            if(v2 < minY) minY = v2; if(v2 > maxY) maxY = v2;
                            
                            // 変換 (EPSG:6678 -> WGS84) Proj4は[Y, X]
                            try {
                                const wgs = proj4("EPSG:6678", "WGS84", [v2, v1]);
                                points.push([wgs[1], wgs[0]]); // Leafletは[Lat, Lon]
                            } catch(err){}
                            break; // 1行1点
                        }
                    }
                });

                if(points.length === 0) {
                    status.textContent = "座標データが見つかりませんでした。";
                    alert("座標データが見つかりませんでした。\nSIMAファイル(第10系)か確認してください。");
                    return;
                }

                simaLayer.clearLayers();
                
                // ポリゴン (薄い赤)
                const poly = L.polygon(points, {color: '#FF6666', weight: 3, fillOpacity: 0.2}).addTo(simaLayer);
                
                // プロット (印刷時はクラスで消す)
                points.forEach(p => {
                    L.circleMarker(p, {radius: 3, color: 'blue', className: 'sima-marker'}).addTo(simaLayer);
                });

                map.fitBounds(poly.getBounds());
                status.textContent = `読込完了: ${points.length}点`;
                printLabel = ""; // SIMA時は空欄
                
                // 地図サイズ再調整
                setTimeout(() => { map.invalidateSize(); }, 200);
            };
            reader.readAsText(file, "Shift_JIS");
        }

        simaInput.addEventListener('change', e => { if(e.target.files[0]) handleFile(e.target.files[0]); });
        
        dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.style.background='#eef4fb'; });
        dropArea.addEventListener('dragleave', e => { e.preventDefault(); dropArea.style.background='#fafafa'; });
        dropArea.addEventListener('drop', e => { 
            e.preventDefault(); 
            dropArea.style.background='#fafafa';
            if(e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
        });

        // 印刷
        function printMap() {
            document.getElementById('printLocation').textContent = printLabel;
            alert("【印刷のコツ】\n・用紙サイズ：A4\n・向き：縦\n\nに設定して印刷またはPDF保存してください。");
            window.print();
        }
        window.printMap = printMap; // グローバル公開

        // --- 2. 坪平米 ---
        const tsubo = document.getElementById('tsubo');
        const heibei = document.getElementById('heibei');
        const jou = document.getElementById('jou');
        const T=3.30578, J=1.6562;
        tsubo.oninput = function(){ const v=parseFloat(this.value); if(v){heibei.value=(v*T).toFixed(2); jou.value=((v*T)/J).toFixed(2);} };
        heibei.oninput = function(){ const v=parseFloat(this.value); if(v){tsubo.value=(v/T).toFixed(2); jou.value=(v/J).toFixed(2);} };
        jou.oninput = function(){ const v=parseFloat(this.value); if(v){heibei.value=(v*J).toFixed(2); tsubo.value=((v*J)/T).toFixed(2);} };

        // --- 3. 登録免許税 ---
        window.calcTax = function(rate) {
            const v = parseInt(document.getElementById('taxVal').value);
            if(!v) return;
            const base = Math.floor(v/1000)*1000;
            let tax = Math.floor(base*rate);
            tax = Math.floor(tax/100)*100;
            if(tax<1000) tax=1000;
            document.getElementById('taxRes').innerText = "約 " + tax.toLocaleString() + " 円";
        };

        // --- 4. 相続図 ---
        window.addHeir = function() {
            const div = document.createElement('div');
            div.className = 'family-input-row';
            div.innerHTML = `<select class="heir-rel" style="width:90px;"><option>子</option><option>長男</option><option>二男</option><option>長女</option></select><input class="heir-name" placeholder="氏名" style="flex:1;"><button class="btn-del" onclick="this.parentElement.remove()">×</button>`;
            document.getElementById('heirRows').appendChild(div);
        };
        window.drawFam = function() {
            const c = document.getElementById('famCanvas');
            const ctx = c.getContext('2d');
            const dName = document.getElementById('decName').value || "被相続人";
            const sName = document.getElementById('spName').value;
            
            document.getElementById('canvasContainer').style.display='block';
            ctx.fillStyle="#fff"; ctx.fillRect(0,0,800,600);
            ctx.fillStyle="#000"; ctx.strokeStyle="#000"; ctx.font="bold 16px sans-serif";
            
            // 簡易描画
            ctx.fillText("相続関係説明図", 30, 40);
            ctx.strokeRect(300, 100, 150, 60);
            ctx.fillText(dName, 310, 135);
            
            if(sName) {
                ctx.strokeRect(500, 100, 150, 60);
                ctx.fillText(sName, 510, 135);
                ctx.beginPath(); ctx.moveTo(450,125); ctx.lineTo(500,125); ctx.moveTo(450,135); ctx.lineTo(500,135); ctx.stroke();
            }
            
            // 子の描画（簡易）
            const kids = document.querySelectorAll('#heirRows .heir-name');
            let startX = 200;
            kids.forEach((k, i) => {
                if(i===0) return; // 配偶者スキップ
                if(k.value) {
                    ctx.strokeRect(startX, 250, 120, 60);
                    ctx.fillText(k.value, startX+10, 285);
                    ctx.beginPath(); ctx.moveTo(400,160); ctx.lineTo(startX+60,250); ctx.stroke();
                    startX += 140;
                }
            });
        };

        // --- 5. 郵便番号 ---
        window.searchZip = function() {
            const z = document.getElementById('zipIn').value.replace('-','');
            if(z.length!=7) return;
            fetch('https://zipcloud.ibsnet.co.jp/api/search?zipcode='+z).then(r=>r.json()).then(d=>{
                document.getElementById('zipOut').innerText = d.results ? d.results[0].address1+d.results[0].address2+d.results[0].address3 : "該当なし";
            });
        };
        window.searchAddr = function() {
            const a = document.getElementById('addrIn').value;
            if(a) window.open('https://www.google.com/search?q='+encodeURIComponent(a)+'+郵便番号');
        };

    });
    </script>
</div>

<footer>
    <p>© 2024 Uemura Land and House Investigator & Administrative Scrivener Office.</p>
</footer>

</body>
</html>
