<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="YdkYdalhqx1MHFQb7aFVKFsD7n2bUpgKDN--q0rWI9E" />

    <script src="https://unpkg.com/imagetracerjs@1.2.6/imagetracer_v1.2.6.js"></script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LegalService",
      "name": "植村 土地家屋調査士・行政書士事務所",
      "image": "https://ku-nel0929.github.io/work-pages/sokkia-bg.png",
      "url": "https://ku-nel0929.github.io/work-pages/",
      "telephone": "080-7231-9467",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "花城町12番6号",
        "addressLocality": "花巻市",
        "addressRegion": "岩手県",
        "postalCode": "025-0075",
        "addressCountry": "JP"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": 39.3905,
        "longitude": 141.1186
      },
      "priceRange": "相談無料",
      "description": "岩手県花巻市の農地転用許可申請、土地の測量・分筆登記なら植村事務所へ。登録免許税計算や相続関係図作成ツールも無料公開中。"
    }
    </script>

    <title>農地転用・測量・相続なら | 植村 土地家屋調査士・行政書士事務所</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary-color: #0f2350; --survey-color: #c5a059; --admin-color: #3b6c9b; --text-color: #333; --white: #ffffff; --bg-body: #e0e0e0; --bg-form: #f9fbfd; --content-width: 1000px; }
        body { font-family: "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 0; color: var(--text-color); line-height: 1.6; background-color: var(--bg-body); width: 100%; }
        a { text-decoration: none; color: inherit; } img { max-width: 100%; height: auto; }
        .site-container { max-width: var(--content-width); width: 100%; margin: 0 auto; background-color: var(--white); box-shadow: 0 0 15px rgba(0,0,0,0.1); overflow: hidden; }
        header { width: 100%; background-color: var(--primary-color); color: var(--white); padding: 15px 0; text-align: center; } .logo { font-size: 1.4rem; font-weight: bold; }
        .hero { width: 100%; position: relative; background-color: #87CEEB; background-image: url('sokkia-bg.png'); background-size: cover; background-position: center; height: 400px; display: flex; align-items: center; justify-content: center; text-align: center; color: var(--white); text-shadow: 0 2px 8px rgba(0,0,0,0.7); }
        .hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.3); } .hero-content { position: relative; z-index: 2; width: 100%; padding: 0 20px; box-sizing: border-box; } .hero-content h1 { font-size: 2.2rem; font-weight: bold; line-height: 1.4; margin: 0; }
        @media (max-width: 768px) { .hero { height: 300px; } .hero-content h1 { font-size: 1.5rem; } }
        .main-wrapper { padding: 50px 20px 60px; }
        .main-actions { margin-bottom: 40px; } .action-grid { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; } .action-box { flex: 1; min-width: 280px; padding: 30px 20px; border-radius: 8px; text-align: center; color: var(--white); box-shadow: 0 4px 8px rgba(0,0,0,0.15); transition: transform 0.2s; } .action-box:hover { transform: translateY(-3px); } .box-survey { background-color: var(--survey-color); } .box-admin { background-color: var(--admin-color); } .box-title { display: block; font-size: 1.4rem; font-weight: bold; margin-bottom: 15px; } .phone-area { background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 30px; display: inline-flex; align-items: center; gap: 10px; font-weight: bold; font-size: 1.2rem; }
        .contact-section { padding: 40px 0; } .section-title { text-align: center; color: var(--primary-color); border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-bottom: 30px; } .contact-form { max-width: 800px; margin: 0 auto; background-color: var(--bg-form); padding: 30px; border-radius: 8px; border: 1px solid #ddd; } .form-group { margin-bottom: 20px; } .form-label { display: block; font-weight: bold; margin-bottom: 5px; color: var(--primary-color); } .form-input, .form-textarea, .form-select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1rem; } .form-textarea { height: 120px; } .submit-btn { background-color: var(--primary-color); color: white; border: none; padding: 15px 40px; font-size: 1.1rem; font-weight: bold; border-radius: 5px; cursor: pointer; display: block; margin: 30px auto 0; width: 100%; max-width: 300px; } .submit-btn:hover { opacity: 0.9; } .required { background: #d9534f; color: white; padding: 2px 5px; font-size: 0.7rem; border-radius: 3px; margin-left: 5px; } .optional { background: #999; color: white; padding: 2px 5px; font-size: 0.7rem; border-radius: 3px; margin-left: 5px; }
        .mail-info-box { background: #fff; border: 2px solid #ddd; border-radius: 8px; padding: 15px; text-align: center; } .mail-address { font-size: 1.1rem; font-weight: bold; color: var(--primary-color); display: block; margin: 10px 0; word-break: break-all; } .mail-btn-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; } .copy-btn { background-color: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; } .launch-btn { background-color: var(--admin-color); color: white; text-decoration: none; padding: 8px 15px; border-radius: 4px; font-size: 0.9rem; display: inline-block; }
        .column-section { padding: 40px 0; max-width: 900px; margin: 0 auto; } .column-article { margin-bottom: 40px; border-bottom: 1px solid #eee; padding-bottom: 20px; } .column-title { color: var(--primary-color); font-size: 1.4rem; margin-bottom: 10px; font-weight: bold; display: flex; align-items: center; gap: 10px; } .column-text { font-size: 0.95rem; line-height: 1.8; color: #444; } .nou-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9rem; } .nou-table th, .nou-table td { border: 1px solid #ccc; padding: 10px; } .nou-table th { background-color: #f0f0f0; text-align: center; width: 20%; }
        .tool-section { padding: 40px 20px; max-width: 800px; margin: 0 auto 40px; background-color: #f5f8fc; border-radius: 8px; border: 1px solid #dce4ec; } .tool-box { background: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; } .tool-header { text-align: center; margin-bottom: 15px; font-weight: bold; color: var(--primary-color); border-bottom: 1px dashed #ccc; padding-bottom: 10px; } .tool-input-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center; } .tool-btn { background-color: var(--admin-color); color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; white-space: nowrap; text-align: center; text-decoration: none; display: inline-block; font-size: 1rem; } .tool-btn:hover { opacity: 0.9; } .dl-btn-disabled { background-color: #ccc !important; cursor: not-allowed !important; pointer-events: none; opacity: 0.6; }
        .tool-result { background-color: #0f2350; color: white; padding: 20px; border-radius: 5px; } .tool-result-item { margin-bottom: 10px; font-size: 1.1rem; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px; display: flex; align-items: center; } .tool-result-item:last-child { border-bottom: none; margin-bottom: 0; } .tool-label { font-size: 0.8rem; opacity: 0.8; display: block; min-width: 100px; } .zodiac-icon { width: 28px; height: 28px; margin-left: 10px; fill: #fff; vertical-align: middle; }
        .family-input-row { display: flex; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 10px; align-items: center; flex-wrap: wrap; } .family-input-row input, .family-input-row select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; min-width: 0; } .btn-add { background-color: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; } .btn-del { background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; } #canvasContainer { text-align: center; overflow-x: auto; margin-top: 20px; display: none; } canvas { max-width: 100%; height: auto; }
        .preview-area { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; } .preview-box { flex: 1; border: 1px solid #ddd; padding: 10px; text-align: center; background: #fafafa; min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; } .preview-label { position: absolute; top: 5px; left: 5px; background: #333; color: #fff; font-size: 0.7rem; padding: 2px 6px; border-radius: 3px; opacity: 0.8; } .preview-box canvas, .preview-box svg { max-width: 100%; max-height: 250px; width: auto; height: auto; border: 1px dashed #ccc; }
        #libErrorBanner { display: none; background-color: #d9534f; color: white; text-align: center; padding: 10px; margin-bottom: 15px; border-radius: 4px; font-weight: bold; }
        .office-info { text-align: center; margin-top: 50px; padding: 20px; background: #f9f9f9; } .map-container { width: 100%; height: 350px; margin-top: 20px; background: #eee; } footer { width: 100%; background-color: var(--primary-color); color: #aaa; text-align: center; padding: 20px 0; font-size: 0.8rem; }
        @media print { @page { size: A4 portrait; margin: 5mm; } body { background: white !important; height: 100vh; margin: 0 !important; padding: 0 !important; width: 100% !important; } body > * { display: none !important; } .site-container { display: block !important; width: 100% !important; margin: 0 !important; padding: 0 !important; max-width: none !important; box-shadow: none !important; } .main-wrapper { padding: 0 !important; } header, footer, .hero, .main-actions, .contact-section, .column-section, .office-info, .tool-section > h2, .tool-section > p, .tool-box > *:not(#printHeader), .tool-input-group { display: none !important; } .tool-section, .tool-box { border: none !important; box-shadow: none !important; margin: 0 !important; padding: 0 !important; width: 100% !important; } }
        @media (max-width: 600px) { .family-input-row { gap: 5px; } .heir-rel { flex-basis: 35%; } .heir-name { flex: 1; } .heir-addr { flex-basis: 100% !important; margin-top: 5px; width: 100%; } .btn-del { margin-left: auto; } }
    </style>
</head>
<body>

<div class="site-container">
    <header><div class="logo">植村 土地家屋調査士・行政書士事務所</div></header>
    <section class="hero"><div class="hero-content"><h1>家づくり・土地活用。<br>「測量」と「許認可」をワンストップで。</h1></div></section>

    <div class="main-wrapper">
        <div class="main-actions"><div class="action-grid"><div class="action-box box-survey"><a href="business-guide.png" target="_blank" style="text-decoration:none; color:white;"><span class="box-title" style="text-decoration:underline; text-underline-offset: 4px;">土地家屋調査士業務 <i class="fa-regular fa-image" style="font-size:0.8em;"></i></span></a><a href="tel:08072319467"><div class="phone-area"><i class="fa-solid fa-mobile-screen"></i><span class="phone-number">080-7231-9467</span></div></a></div><div class="action-box box-admin"><a href="admin-guide.png" target="_blank" style="text-decoration:none; color:white;"><span class="box-title" style="text-decoration:underline; text-underline-offset: 4px;">行政書士業務 <i class="fa-regular fa-image" style="font-size:0.8em;"></i></span></a><a href="tel:07066256247"><div class="phone-area"><i class="fa-solid fa-mobile-screen"></i><span class="phone-number">070-6625-6247</span></div></a></div></div></div>

        <div class="contact-section">
            <h2 class="section-title">お問い合わせ・ご相談</h2>
            <form action="https://formspree.io/f/mdkqdjlz" method="POST" class="contact-form" autocomplete="off">
                <div class="form-group"><label class="form-label">お名前 <span class="required">必須</span></label><input type="text" name="お名前" class="form-input" required></div>
                <div class="form-group"><label class="form-label">メールアドレス <span class="required">必須</span></label><input type="email" name="email" class="form-input" required></div>
                <div class="form-group"><label class="form-label">お電話番号 <span class="optional">任意</span></label><input type="tel" name="電話番号" class="form-input"></div>
                <div class="form-group"><label class="form-label">資料・図面の送付について</label><div class="mail-info-box"><p style="font-size:0.9rem; margin:0 0 10px 0;">図面や写真などの資料がある場合は、以下のメールアドレスへ直接お送りください。</p><span id="copyTarget" class="mail-address">info@uemura-office12-6.com</span><div class="mail-btn-group"><button type="button" class="copy-btn" id="emailCopyBtn"><i class="fa-regular fa-copy"></i> アドレスをコピー</button><a href="mailto:info@uemura-office12-6.com" class="launch-btn"><i class="fa-solid fa-envelope"></i> メールソフトで起動</a></div></div></div>
                <div class="form-group"><label class="form-label">ご相談内容 <span class="required">必須</span></label><textarea name="詳細" class="form-textarea" required></textarea></div>
                <button type="submit" class="submit-btn">送信する</button>
            </form>
        </div>

        <div class="column-section"><h2 class="section-title">お役立ち情報</h2><article class="column-article"><h3 class="column-title" style="color:#d9534f;"><i class="fa-solid fa-triangle-exclamation"></i> 【重要】相続登記義務化</h3><p class="column-text">2024年4月より相続登記が義務化されました。放置すると過料の対象となる可能性があります。</p></article><article class="column-article"><h3 class="column-title"><i class="fa-solid fa-book-open"></i> 農地転用許可・届出（3条・4条・5条）について</h3><p class="column-text">花巻市で農地を宅地にするには「農地転用許可」が必要です。</p></article><article class="column-article"><h3 class="column-title"><i class="fa-solid fa-map-location-dot"></i> 境界確定測量</h3><p class="column-text">土地の境界トラブル防止には「境界確定測量」が必要です。</p></article></div>

        <div class="tool-section"><h2 class="section-title">【便利ツール】坪 ⇔ 平米(㎡) ⇔ 畳 換算</h2><div class="tool-box"><div class="family-input-row"><span class="tool-label">坪数</span><input type="number" id="tsuboInput" class="form-input"></div><div class="family-input-row"><span class="tool-label">平米</span><input type="number" id="m2Input" class="form-input"></div><div class="family-input-row"><span class="tool-label">畳数</span><input type="number" id="joInput" class="form-input"></div></div></div>
        
        <div class="tool-section" style="margin-top:-20px;"><h2 class="section-title">【便利ツール】登録免許税 (概算) 計算</h2><div class="tool-box"><div class="family-input-row"><span class="tool-label">評価額</span><input type="number" id="taxValue" class="form-input" placeholder="円"></div><div style="display:flex; gap:10px; margin-top:10px; justify-content:center;"><button class="tool-btn" onclick="calcTax(0.004, '所有権保存')">保存 (0.4%)</button><button class="tool-btn" onclick="calcTax(0.02, '所有権移転')">移転 (2.0%)</button><button class="tool-btn" onclick="calcTax(0.004, '抵当権設定')">抵当権 (0.4%)</button></div><div id="taxResult" style="background:#f9f9f9; padding:10px; margin-top:15px; text-align:center;">---</div></div></div>

        <div class="tool-section"><h2 class="section-title">【無料ツール】相続関係説明図メーカー</h2><div class="tool-box"><div class="tool-header">被相続人</div><div class="family-input-row"><input type="text" id="decedentName" placeholder="氏名" style="flex:2;"><input type="text" id="decedentDate" placeholder="死亡日" style="flex:2;"></div><div class="family-input-row"><input type="text" id="decedentAddress" placeholder="住所" style="flex:4;"></div><div class="tool-header" style="margin-top:20px;">相続人</div><div id="heirsContainer"><div class="family-input-row"><select class="heir-rel" disabled><option>配偶者</option></select><input type="text" class="heir-name" placeholder="氏名"><input type="text" class="heir-addr" placeholder="住所"></div></div><div style="text-align:right; margin:10px 0;"><button class="btn-add" id="addHeirBtn">＋追加</button></div><div style="text-align:center;"><button class="tool-btn" id="genMapBtn">作成</button> <button class="tool-btn" id="downloadMapBtn" style="display:none; background-color:#c5a059;">保存</button></div></div><div id="canvasContainer" style="display:none;"><canvas id="familyCanvas" width="800" height="600"></canvas></div></div>

        <div class="tool-section"><h2 class="section-title">【便利ツール】西暦・和暦・年齢・干支 変換</h2><div class="tool-box"><div class="tool-input-group"><select id="eraSelect" class="form-select"><option value="AD">西暦</option><option value="Reiwa">令和</option><option value="Heisei">平成</option><option value="Showa">昭和</option></select><input type="number" id="yearInput" class="form-input" placeholder="年"></div><div class="tool-result"><div class="tool-result-item"><span class="tool-label">西暦</span><span id="resAD">---</span></div><div class="tool-result-item"><span class="tool-label">和暦</span><span id="resEra">---</span></div><div class="tool-result-item"><span class="tool-label">年齢</span><span id="resAge">---</span></div><div class="tool-result-item"><span class="tool-label">干支</span><span id="resZodiac">---</span></div></div></div></div>

        <div class="tool-section" style="margin-top:-20px;"><h2 class="section-title">【便利ツール】郵便番号 ↔ 住所 検索</h2><div class="tool-box"><div class="tool-header">郵便番号 <i class="fa-solid fa-arrow-right"></i> 住所</div><div class="tool-input-group"><input type="text" id="zipInput" class="form-input" placeholder="例: 0250075"><button id="zipSearchBtn" class="tool-btn">検索</button></div><div id="zipResult" style="padding:10px;"></div></div><div class="tool-box"><div class="tool-header">住所 <i class="fa-solid fa-arrow-right"></i> 郵便番号</div><div class="tool-input-group"><input type="text" id="addrInput" class="form-input" placeholder="例: 花巻市花城町"><button id="addrSearchBtn" class="tool-btn" style="background-color:#4285F4;">検索</button></div></div></div>

        <div class="tool-section">
            <h2 class="section-title">【便利ツール】外字作成支援ツール</h2>
            <p style="text-align:center; font-size:0.9rem; margin-bottom:15px;">手書き文字などの画像を、Excel用(SVG)または外字エディタ用(BMP)に変換します。</p>
            
            <div id="libErrorBanner"><i class="fa-solid fa-triangle-exclamation"></i> 変換プログラムが読み込めませんでした。<br><button onclick="location.reload()" style="background:#fff; color:#d9534f; border:none; padding:5px 10px; margin-top:5px; cursor:pointer;">ページを再読み込み</button></div>

            <div class="tool-box">
                <div class="tool-input-group" style="border-bottom:1px dashed #ccc; padding-bottom:15px; margin-bottom:15px;">
                    <div style="flex:1;">
                        <label style="font-weight:bold; font-size:0.9rem; display:block;">① 画像を選択</label>
                        <input type="file" id="imageInput" accept="image/*" class="form-input" style="padding:8px;">
                    </div>
                    <div style="flex:1;">
                        <label style="font-weight:bold; font-size:0.9rem; display:block;">② 濃さ調整: <span id="thresholdValue">128</span></label>
                        <input type="range" id="thresholdRange" min="0" max="255" value="128" style="width:100%; cursor:pointer;">
                    </div>
                </div>

                <div class="preview-area">
                    <div class="preview-box">
                        <span class="preview-label">白黒変換 (BMP用)</span>
                        <canvas id="processCanvas"></canvas>
                        <p id="canvasPlaceholder" style="color:#aaa; font-size:0.8rem; margin-top:20px;">ここに画像が表示されます</p>
                    </div>
                    <div class="preview-box">
                        <span class="preview-label">アウトライン (Excel用)</span>
                        <div id="svgContainer"></div>
                        <p id="svgPlaceholder" style="color:#aaa; font-size:0.8rem; margin-top:20px;">変換結果が表示されます</p>
                    </div>
                </div>

                <div style="display:flex; gap:10px; justify-content:center; margin-top:15px; flex-wrap:wrap;">
                    <button id="downloadBtn" class="tool-btn dl-btn-disabled" style="width:200px;">SVGを保存 (Excel用)</button>
                    <button id="downloadBmpBtn" class="tool-btn dl-btn-disabled" style="width:200px; background-color:#333;">BMP保存 (外字エディタ用)</button>
                </div>
                <div style="margin-top:10px; font-size:0.85rem; color:#666; background:#f9f9f9; padding:10px; border-radius:4px;">
                    <strong>【外字エディタへの貼り付け方】</strong><br>
                    1. 「BMP保存」で保存したファイルを <strong>「ペイント」</strong> で開く。<br>
                    2. [Ctrl]+[A]ですべて選択し、[Ctrl]+[C]でコピー。<br>
                    3. 外字エディタを開き、編集画面で [Ctrl]+[V] で貼り付ける。
                </div>
            </div>
        </div>

        <div class="office-info"><h3>植村 土地家屋調査士・行政書士事務所</h3><p>〒025-0075 岩手県花巻市花城町12番6号</p><div class="map-container"><iframe src="https://maps.google.co.jp/maps?output=embed&q=岩手県花巻市花城町12-6" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe></div></div>
        <footer><p>© 2024 Uemura Land and House Investigator & Administrative Scrivener Office.</p></footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // メールコピー
        const copyBtn = document.getElementById('emailCopyBtn');
        if(copyBtn) { copyBtn.addEventListener('click', function() { const email = document.getElementById('copyTarget').innerText; navigator.clipboard.writeText(email).then(function() { const originalText = copyBtn.innerHTML; copyBtn.innerHTML = '<i class="fa-solid fa-check"></i> コピーしました'; setTimeout(() => { copyBtn.innerHTML = originalText; }, 2000); }, function(err) { alert('コピーに失敗しました'); }); }); }

        // 登録免許税
        window.calcTax = function(rate, typeName) { const valStr = document.getElementById('taxValue').value; const val = parseInt(valStr); const resBox = document.getElementById('taxResult'); if (!val || val <= 0) { resBox.innerHTML = '<span style="color:red;">評価額を正しく入力してください</span>'; return; } const baseAmount = Math.floor(val / 1000) * 1000; let tax = Math.floor(baseAmount * rate); tax = Math.floor(tax / 100) * 100; if (tax < 1000) tax = 1000; resBox.innerHTML = `<strong>${typeName}</strong><br><span style="font-size:1.4rem; color:#c5a059;">約 ${tax.toLocaleString()} 円</span>`; };

        // 坪平米
        const tsuboInput=document.getElementById('tsuboInput'), m2Input=document.getElementById('m2Input'), joInput=document.getElementById('joInput');
        if(tsuboInput){ const T=3.30578, J=1.6562; tsuboInput.addEventListener('input',function(){ const v=parseFloat(this.value); if(!isNaN(v)){m2Input.value=(v*T).toFixed(2);joInput.value=((v*T)/J).toFixed(2)}else{m2Input.value='';joInput.value=''} }); m2Input.addEventListener('input',function(){ const v=parseFloat(this.value); if(!isNaN(v)){tsuboInput.value=(v/T).toFixed(2);joInput.value=(v/J).toFixed(2)}else{tsuboInput.value='';joInput.value=''} }); joInput.addEventListener('input',function(){ const v=parseFloat(this.value); if(!isNaN(v)){m2Input.value=(v*J).toFixed(2);tsuboInput.value=((v*J)/T).toFixed(2)}else{tsuboInput.value='';m2Input.value=''} }); }

        // 相続図
        const genMapBtn=document.getElementById('genMapBtn');
        if(genMapBtn){ const addBtn=document.getElementById('addHeirBtn'), heirsCont=document.getElementById('heirsContainer'), dlBtn=document.getElementById('downloadMapBtn'), cvsCont=document.getElementById('canvasContainer'), canvas=document.getElementById('familyCanvas'), ctx=canvas.getContext('2d'); addBtn.onclick=function(){const d=document.createElement('div');d.className='family-input-row';d.innerHTML=`<select class="heir-rel" style="width:90px;"><option>長男</option><option>二男</option><option>三男</option><option>長女</option><option>二女</option><option>三女</option><option>養子</option><option>子</option></select><input class="heir-name" placeholder="氏名" style="flex:1;"><input class="heir-addr" placeholder="住所" style="flex:2;"><button class="btn-del" onclick="this.parentElement.remove()">×</button>`;heirsCont.appendChild(d)}; genMapBtn.onclick=function(){ const decName=document.getElementById('decedentName').value||"被相続人", decDate=document.getElementById('decedentDate').value||"", decAddr=document.getElementById('decedentAddress').value||""; const heirs=document.querySelectorAll('#heirsContainer .family-input-row'); let sp=null, ch=[]; heirs.forEach(r=>{ const rel=r.querySelector('.heir-rel').value, nm=r.querySelector('.heir-name').value, ad=r.querySelector('.heir-addr').value; if(nm){if(rel=='配偶者')sp={n:nm,a:ad,r:rel}; else ch.push({n:nm,a:ad,r:rel});}}); cvsCont.style.display='block'; dlBtn.style.display='inline-block'; ctx.fillStyle="#fff"; ctx.fillRect(0,0,800,600); ctx.strokeStyle="#000"; ctx.lineWidth=2; ctx.font="16px sans-serif"; ctx.textAlign="left"; ctx.textBaseline="middle"; ctx.fillStyle="#000"; ctx.font="bold 20px sans-serif"; ctx.fillText("相続関係説明図",30,40); const drawB=(x,y,l1,l2,l3)=>{ctx.strokeRect(x,y,160,80);ctx.fillText(l1,x+10,y+25);ctx.font="12px sans-serif";if(l2)ctx.fillText(l2,x+10,y+45);if(l3)ctx.fillText(l3,x+10,y+65);ctx.font="bold 14px sans-serif";}; let cx=400, sy=100, dx=sp?cx-110:cx-80; drawB(dx,sy,`被相続人 ${decName}`,decDate,decAddr); if(sp){ let sx=dx+220; drawB(sx,sy,`${sp.r} ${sp.n}`,"",sp.a); ctx.beginPath(); ctx.moveTo(dx+160,sy+37); ctx.lineTo(sx,sy+37); ctx.moveTo(dx+160,sy+43); ctx.lineTo(sx,sy+43); ctx.stroke(); } if(ch.length>0){ let pcx=sp?dx+190:dx+80, cy=sy+140; ctx.beginPath(); ctx.moveTo(pcx,sy+(sp?40:80)); ctx.lineTo(pcx,cy-20); ctx.stroke(); let tw=(160*ch.length)+(40*(ch.length-1)), scx=pcx-(tw/2); ctx.beginPath(); ctx.moveTo(scx+80,cy-20); ctx.lineTo(scx+tw-80,cy-20); ctx.stroke(); ch.forEach((c,i)=>{ let kx=scx+(200*i); ctx.beginPath(); ctx.moveTo(kx+80,cy-20); ctx.lineTo(kx+80,cy); ctx.stroke(); drawB(kx,cy,`${c.r} ${c.n}`,"",c.a); }); } ctx.font="12px sans-serif"; ctx.fillText("作成：植村 土地家屋調査士・行政書士事務所", 550, 580); }; dlBtn.onclick=function(){const a=document.createElement('a');a.download='sozoku.png';a.href=canvas.toDataURL();a.click()}; }

        // 年齢
        const eraSel=document.getElementById('eraSelect'), yrIn=document.getElementById('yearInput');
        if(eraSel){ const zD=["申","酉","戌","亥","子","丑","寅","卯","辰","巳","午","未"]; const zIcons = ["M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm2-13h-4v2h4V7zm-4 4h4v2h-4v-2zm0 4h4v2h-4v-2z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3 15h-2v-2h2v2zm0-4h-2V7h2v6z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2V7zm0 8h2v2h-2v-2z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.85-12.15l-1.2-1.2c-.2-.2-.51-.2-.71 0l-1.2 1.2c-.2.2-.2.51 0 .71l1.2 1.2c.2.2.51.2.71 0l1.2-1.2c.19-.2.19-.51-.01-.71zm3.5 3.5l-1.2-1.2c-.2-.2-.51-.2-.71 0l-1.2 1.2c-.2.2-.2.51 0 .71l1.2 1.2c.2.2.51.2.71 0l1.2-1.2c.2-.2.2-.51 0-.71zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2.5-9.5l1.5 1.5 3.5-3.5 1.5 1.5-5 5-3-3 1.5-1.5z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4 11h-2v-2h-1v2H9v2h1v1h1v-1h2v1h1v-1h1v-2zm-1-6h-2v3h-1V7H9v3H8V7H6v5h1v2h1v-2h1v2h1v-2h1V7z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm1-5h-2V7h2v4zm0 4h-2v-2h2v2z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm2.5-9.5l-1.5-1.5-3.5 3.5-1.5-1.5L6 12l5 5 3-3-1.5-1.5z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4 11h-2v-2h-1v2H9v2h1v1h1v-1h2v1h1v-1h1v-2zm-1-6h-2v3h-1V7H9v3H8V7H6v5h1v2h1v-2h1v2h1v-2h1V7z","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3 15h-2v-2h2v2zm0-4h-2V7h2v6z"];
            const cE=function(){ const v=parseInt(yrIn.value); if(isNaN(v)){document.getElementById('resAge').innerText='---';return;} let ad=v; if(eraSel.value=='Reiwa')ad+=2018; else if(eraSel.value=='Heisei')ad+=1988; else if(eraSel.value=='Showa')ad+=1925; else if(eraSel.value=='Taisho')ad+=1911; else if(eraSel.value=='Meiji')ad+=1867; document.getElementById('resAD').innerText=ad+"年"; document.getElementById('resAge').innerText=(new Date().getFullYear()-ad)+"歳"; const idx=ad%12; document.getElementById('resZodiac').innerHTML=`${zD[idx]}<svg class="zodiac-icon" viewBox="0 0 24 24"><path d="${zIcons[idx]}"/></svg>`; };
            eraSel.onchange=cE; yrIn.oninput=cE;
        }

        // 郵便番号
        const zipBtn = document.getElementById('zipSearchBtn'), zipResult = document.getElementById('zipResult'), zipInput = document.getElementById('zipInput'), addrSearchBtn = document.getElementById('addrSearchBtn'), addrInput = document.getElementById('addrInput');
        if(zipBtn && zipResult && zipInput){ zipBtn.onclick = function(){ const zip = zipInput.value.replace(/[^\d]/g, ''); if(zip.length !== 7){ zipResult.innerHTML = '<span style="color:red;">7桁の数字を入力してください</span>'; return; } zipResult.innerText = "検索中..."; fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${zip}`).then(r => r.json()).then(d => { if(d.results){ const r = d.results[0]; zipResult.innerHTML = `<strong>${r.address1} ${r.address2} ${r.address3}</strong><br><small>(${r.kana1} ${r.kana2} ${r.kana3})</small>`; } else { zipResult.innerHTML = '<span style="color:red;">該当する住所が見つかりません</span>'; } }).catch(err => { zipResult.innerHTML = '<span style="color:red;">検索エラー（通信失敗）</span>'; }); }; }
        if(addrSearchBtn && addrInput){ addrSearchBtn.onclick = function(){ const val = addrInput.value; if(!val) return; window.open(`https://www.google.com/search?q=${encodeURIComponent(val)}+郵便番号`); }; }

        // --- 外字支援ツール ---
        const imgIn = document.getElementById('imageInput'), thRange = document.getElementById('thresholdRange'), thVal = document.getElementById('thresholdValue'), pCv = document.getElementById('processCanvas'), svgCont = document.getElementById('svgContainer'), dlBtn = document.getElementById('downloadBtn'), dlBmpBtn = document.getElementById('downloadBmpBtn');
        if(typeof ImageTracer === 'undefined'){ document.getElementById('libErrorBanner').style.display = 'block'; }
        let origImg = null;

        if(imgIn && pCv && svgCont && dlBtn && dlBmpBtn){
            const ctx = pCv.getContext('2d');
            imgIn.addEventListener('change', function(e) { const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = function(ev) { origImg = new Image(); origImg.onload = function() { pCv.width = origImg.width; pCv.height = origImg.height; updateTracer(); document.getElementById('canvasPlaceholder').style.display='none'; document.getElementById('svgPlaceholder').style.display='none'; dlBtn.classList.remove('dl-btn-disabled'); dlBmpBtn.classList.remove('dl-btn-disabled'); }; origImg.src = ev.target.result; }; r.readAsDataURL(f); });
            thRange.addEventListener('input', function(e){ thVal.innerText = e.target.value; if(origImg) updateTracer(); });

            function updateTracer(){
                if(!origImg) return;
                ctx.drawImage(origImg, 0, 0);
                const iData = ctx.getImageData(0,0,pCv.width,pCv.height);
                const d = iData.data;
                const th = parseInt(thRange.value);
                for(let i=0; i<d.length; i+=4){
                    const b = 0.34*d[i] + 0.5*d[i+1] + 0.16*d[i+2];
                    const c = b >= th ? 255 : 0;
                    d[i]=c; d[i+1]=c; d[i+2]=c; // RGBを白黒に
                    d[i+3]=255; // アルファは不透明に
                }
                ctx.putImageData(iData,0,0);
                
                if(typeof ImageTracer !== 'undefined'){
                    const opt = { ltres:1, qtres:1, pathomit:8, colorsampling:0, numberofcolors:2, mincolorratio:0, colorquantcycles:0, scale:1, strokewidth:0, linefilter:false };
                    let svgStr = ImageTracer.imagedataToSVG(iData, opt);
                    svgStr = svgStr.replace(/fill="rgb\(255,255,255\)"/g, 'fill="none"');
                    svgStr = svgStr.replace(/fill="rgb\(0,0,0\)"/g, 'fill="#000000"');
                    svgCont.innerHTML = svgStr;
                }
            }

            // BMPエンコーダー (自作)
            function canvasToBMP(canvas) {
                const w = canvas.width;
                const h = canvas.height;
                const imageData = canvas.getContext('2d').getImageData(0, 0, w, h).data;
                const rgbSize = w * h * 3;
                const headerSize = 54;
                const rowSize = (3 * w + 3) & ~3; // 4バイト境界
                const fileSize = headerSize + rowSize * h;
                const buffer = new ArrayBuffer(fileSize);
                const view = new DataView(buffer);

                // BMP Header
                view.setUint16(0, 0x424D, false); // BM
                view.setUint32(2, fileSize, true);
                view.setUint32(10, headerSize, true);
                view.setUint32(14, 40, true); // DIB Header size
                view.setInt32(18, w, true);
                view.setInt32(22, -h, true); // Top-down
                view.setUint16(26, 1, true); // Planes
                view.setUint16(28, 24, true); // Bit count (24bit RGB)

                let pos = headerSize;
                for (let y = 0; y < h; y++) {
                    for (let x = 0; x < w; x++) {
                        const i = (y * w + x) * 4;
                        view.setUint8(pos++, imageData[i + 2]); // B
                        view.setUint8(pos++, imageData[i + 1]); // G
                        view.setUint8(pos++, imageData[i]);     // R
                    }
                    pos += (rowSize - w * 3); // Padding
                }
                return new Blob([buffer], { type: "image/bmp" });
            }

            // 画像保存 (BMP)
            dlBmpBtn.addEventListener('click', function() {
                if(!origImg) return;
                const blob = canvasToBMP(pCv);
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = 'gaiji.bmp';
                link.href = url;
                link.click();
            });

            // SVG保存
            dlBtn.addEventListener('click', function() {
                const svgContent = svgCont.innerHTML;
                if(!svgContent || svgContent.indexOf('<svg') === -1) { alert('変換結果がありません。'); return; }
                const blob = new Blob([svgContent], {type: "image/svg+xml;charset=utf-8"});
                const url = URL.createObjectURL(blob);
                const tempLink = document.createElement('a');
                tempLink.href = url;
                const fName = imgIn.files[0] ? imgIn.files[0].name.split('.')[0] : "vector";
                tempLink.download = `${fName}.svg`;
                document.body.appendChild(tempLink); tempLink.click(); document.body.removeChild(tempLink);
            });
        }
    });
    </script>
</div>
</body>
</html>
